<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Operators · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Communication Examples"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Operators · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="# Communication Examples"/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/ai/artificial_intelligence" target="_self">AI</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/javadocs/index.html" target="_self">Java Docs</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Operators</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="communication-examples"></a><a href="#communication-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Communication Examples</h1>
<p>Communication examples demonstrate the usage of communication API. The communication API has the
capability of creating the communication among the tasks by abstracting the communication logic to
the API users. Basically, the communication layer does the job of creating the communication of the
tasks in the task graph based on the user description. Communication API supports a simple thread model
to spawn the processes to run the the tasks using built communication. The communication logic is visible
to the users when the communication API is used. Twister2 has the modular structure for supporting
the developer's need. They can plug in the Twister2:Net to support the communication in the projects
without using the other layers in Twister2. In the communication examples we demonstrate how to create
the following collective communications.</p>
<h2><a class="anchor" aria-hidden="true" id="twister2-collective-communications"></a><a href="#twister2-collective-communications" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Twister2 Collective Communications</h2>
<ol>
<li>Reduce</li>
<li>Allreduce</li>
<li>Gather</li>
<li>AllGather</li>
<li>KeyedReduce</li>
<li>KeyedGather</li>
<li>Broadcast</li>
<li>Partition</li>
<li>KeyedPartition</li>
</ol>
<p>After building the project, you can run the batch mode examples as follows.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr &lt;iterations&gt; -workers &lt;workers&gt; -size &lt;data_size&gt; -op <span class="hljs-string">"&lt;operation&gt;"</span> -stages &lt;source_parallelsim&gt;,&lt;sink_parallelism&gt; -&lt;flag&gt; -verify
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="running-option-definitions"></a><a href="#running-option-definitions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Option Definitions</h3>
<ol>
<li>itr : integer number which provides the number of iterations which the application must run</li>
<li>workers : Number of workers needed for the application</li>
<li>data_size : size of the array that is being passed. In the examples, we generate an array specified by this size</li>
<li>op : Collective operation type:
<ol>
<li>reduce</li>
<li>allreduce</li>
<li>gather</li>
<li>allgather</li>
<li>keyed-reduce</li>
<li>keyed-gather</li>
<li>bcast</li>
<li>partition</li>
<li>keyed-partition</li>
</ol></li>
<li>stages : has two params
<ol>
<li>source_parallelism : depending on the collective communication that you prefer select this number</li>
<li>sink_parallelism : depending on the collective communication that you prefer select this number
Example : For reduce communication it can be 4,1 as sink has to be a single point of receive in the reduction
process and source has more data generating points.</li>
</ol></li>
<li>flag : for a batch job this flag must be empty, if it is an streaming job, -stream would state the flag.</li>
<li>verify : -verify flag does the verification of the collective operation. This is an optional parameter.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="communication-example-structure"></a><a href="#communication-example-structure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Communication Example Structure</h3>
<p>The main component of the example is in the compute method of each example class.
Initially, a task plan is created</p>
<pre><code class="hljs css language-java"> <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">compute</span><span class="hljs-params">(WorkerEnvironment workerEnv)</span> </span>{
    TaskPlan taskPlan = Utils.createStageTaskPlan(config, resourcePlan,
        jobParameters.getTaskStages(), workerList);

    Set&lt;Integer&gt; sources = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();
    Integer noOfSourceTasks = jobParameters.getTaskStages().get(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; noOfSourceTasks; i++) {
      sources.add(i);
    }
    <span class="hljs-keyword">int</span> target = noOfSourceTasks;
    <span class="hljs-comment">// create the communication</span>
    reduce = <span class="hljs-keyword">new</span> BReduce(communicator, taskPlan, sources, target,
        <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER), <span class="hljs-keyword">new</span> FinalSingularReceiver(),
        MessageType.INTEGER);

    Set&lt;Integer&gt; tasksOfExecutor = Utils.getTasksOfExecutor(workerId, taskPlan,
        jobParameters.getTaskStages(), <span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> t : tasksOfExecutor) {
      finishedSources.put(t, <span class="hljs-keyword">false</span>);
    }
    <span class="hljs-keyword">if</span> (tasksOfExecutor.size() == <span class="hljs-number">0</span>) {
      sourcesDone = <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-keyword">if</span> (!taskPlan.getChannelsOfExecutor(workerId).contains(target)) {
      reduceDone = <span class="hljs-keyword">true</span>;
    }

    LOG.log(Level.INFO, String.format(<span class="hljs-string">"%d Sources %s target %d this %s"</span>,
        workerId, sources, target, tasksOfExecutor));
    <span class="hljs-comment">// now initialize the workers</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> t : tasksOfExecutor) {
      <span class="hljs-comment">// the map thread where data is produced</span>
      Thread mapThread = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> MapWorker(t));
      mapThread.start();
    }
  }

</code></pre>
<p>First step is to create the task plan and the workers associated with the example
configuration is provided.</p>
<pre><code class="hljs css language-bash"> TaskPlan taskPlan = Utils.createStageTaskPlan(config, resourcePlan,
        jobParameters.getTaskStages(), workerList);
</code></pre>
<p>Then we need to provide the collective communication type that is going to be used.
Along with the final data receiver setting and the data types used in the messaging.</p>
<pre><code class="hljs css language-java"> reduce = <span class="hljs-keyword">new</span> BReduce(communicator, taskPlan, sources, target,
        <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER), <span class="hljs-keyword">new</span> FinalSingularReceiver(),
        MessageType.INTEGER);
</code></pre>
<p>The rest of the logic included in the example, is designed to identify the tasks which have
finished the communication and execution of the tasks. This logic is being encapsulated in
the task layer examples which are in a very simple format. Through out the collective communication
examples, the main changing component is the collective communication defining section.</p>
<h2><a class="anchor" aria-hidden="true" id="batch-examples"></a><a href="#batch-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batch Examples</h2>
<h3><a class="anchor" aria-hidden="true" id="reduce-example"></a><a href="#reduce-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reduce Example</h3>
<p>In the reduction operation, we need specify which kind of mathematical operation that
we are expecting to run, in this case the summation is considered for a integer data set
generated by the program itself. In the following code snippet, the reduction based
communication is built based on the user inputs when running the application.</p>
<pre><code class="hljs css language-java">    reduce = <span class="hljs-keyword">new</span> BReduce(communicator, taskPlan, sources, target,
        <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER), <span class="hljs-keyword">new</span> FinalSingularReceiver(),
        MessageType.INTEGER);
</code></pre>
<p>Running a reduction operation on an array of size 8 array with 4 workers iterating once with source parallelism of 8
and sink parallelism of 1, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"reduce"</span> -stages 8,1 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BReduceExample.java">Communication based Batch Reduce Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="allreduce-example"></a><a href="#allreduce-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AllReduce Example</h3>
<p>In the allreduce operation the example is very similar with the reduce example, but the only change
is the number of stages. The stages in allreduce must obey the condition that source parallelism
and sink parallelism must be equal.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java"> reduce = <span class="hljs-keyword">new</span> BAllReduce(communicator, taskPlan, sources, targets,
        <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER), <span class="hljs-keyword">new</span> FinalSingularReceiver(),
        MessageType.INTEGER);
</code></pre>
<p>Running a allreduction operation on an array of size 8 array with 4 workers iterating once with source parallelism of 8
and sink parallelism of 8, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"allreduce"</span> -stages 8,8 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BAllReduceExample.java">Communication based Batch AllReduce Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="gather-example"></a><a href="#gather-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Gather Example</h3>
<p>In the gather communication, what happens is the data distributed to multiple points are being
gathered to a single point.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">  gather = <span class="hljs-keyword">new</span> BGather(communicator, taskPlan, sources, target,
         MessageType.INTEGER, <span class="hljs-keyword">new</span> FinalReduceReceiver(), <span class="hljs-keyword">false</span>);
</code></pre>
<p>Running a gather operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 1, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"gather"</span> -stages 8,1 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BGatherExample.java">Communication based Batch Gather Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="allgather-example"></a><a href="#allgather-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AllGather Example</h3>
<p>Allgather communication, what happens is the data distributed to multiple points are being
gathered to all the points. So each point will have the data owned by the other points as well.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">  gather = <span class="hljs-keyword">new</span> BAllGather(communicator, taskPlan, sources, targets, <span class="hljs-keyword">new</span> FinalSingularReceiver(),
          MessageType.INTEGER);
</code></pre>
<p>Running a gather operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 8, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"allgather"</span> -stages 8,8 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BAllGatherExample.java">Communication based Batch AllGather Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="partition-example"></a><a href="#partition-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Partition Example</h3>
<p>In Partition communication, what happens is the data can be distributed to multiple points. So each point will have the data owned by the other points as well.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">  partition = <span class="hljs-keyword">new</span> BPartition(communicator, taskPlan, sources, targets,
          MessageType.INTEGER, <span class="hljs-keyword">new</span> PartitionReceiver(), <span class="hljs-keyword">new</span> LoadBalanceSelector(), <span class="hljs-keyword">false</span>);
</code></pre>
<p>The partition logic can be selected by the user. In this example, the LoadBalance selector is being
used.</p>
<p>Running a gather operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 8, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"partition"</span> -stages 8,8 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BPartitionExample.java">Communication based Batch Partition Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="keyedreduce-example"></a><a href="#keyedreduce-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KeyedReduce Example</h3>
<p>In KeyedReduce communication, the logic is same as the basic reduce operation, but when the data is being keyed
based on a given criteria, the keyed-reduce communication can be used to perform the reduction operation.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">   keyedReduce = <span class="hljs-keyword">new</span> BKeyedReduce(communicator, taskPlan, sources, targets,
          <span class="hljs-keyword">new</span> ReduceOperationFunction(Op.SUM, MessageType.INTEGER),
          <span class="hljs-keyword">new</span> FinalBulkReceiver(), MessageType.INTEGER, MessageType.INTEGER,
          <span class="hljs-keyword">new</span> SimpleKeyBasedSelector());
</code></pre>
<p>The key selection logic used in this one is the SimpleKeyBasedSelector.</p>
<p>Running a reduction operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 1, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"keyedreduce"</span> -stages 8,1 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BKeyedReduceExample.java">Communication based Batch Keyed-Reduce Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="keyedgather-example"></a><a href="#keyedgather-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KeyedGather Example</h3>
<p>In Keyed-Gather communication, the logic is same as the basic gather operation, but when the data is being keyed
based on a given criteria, the keyed-gather communication can be used to perform the gather operation.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">       keyedGather = <span class="hljs-keyword">new</span> BKeyedGather(communicator, taskPlan, sources, targets,
           MessageType.INTEGER, MessageType.INTEGER, <span class="hljs-keyword">new</span> FinalReduceReceiver(),
           <span class="hljs-keyword">new</span> SimpleKeyBasedSelector());
</code></pre>
<p>The key selection logic used in this one is the SimpleKeyBasedSelector.</p>
<p>Running a reduction operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 1, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"keyedgather"</span> -stages 8,1 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BKeyedGatherExample.java">Communication based Batch Keyed-Gather Source Code</a></p>
<h3><a class="anchor" aria-hidden="true" id="keyedpartition-example"></a><a href="#keyedpartition-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KeyedPartition Example</h3>
<p>In Keyed-Partition communication, the logic is same as the basic partition operation, but when the data is being keyed
based on a given criteria, the keyed-partition communication can be used to perform the partition operation.</p>
<p>The communication defining section is as follows,</p>
<pre><code class="hljs css language-java">   partition = <span class="hljs-keyword">new</span> BKeyedPartition(communicator, taskPlan, sources, targets, MessageType.INTEGER,
        MessageType.INTEGER, <span class="hljs-keyword">new</span> PartitionReceiver(), <span class="hljs-keyword">new</span> SimpleKeyBasedSelector());
</code></pre>
<p>The key selection logic used in this one is the SimpleKeyBasedSelector.</p>
<p>Running a reduction operation on an array of size 8 with 4 workers iterating once with source parallelism of 8
and sink parallelism of 8, added with result verification.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"keyedpartition"</span> -stages 8,8 -verify
</code></pre>
<p><a href="https://github.com/DSC-SPIDAL/twister2/blob/master/twister2/examples/src/java/edu/iu/dsc/tws/examples/comms/batch/BKeyedPartitionExample.java">Communication based Batch Keyed-Partition Source Code</a></p>
<h2><a class="anchor" aria-hidden="true" id="streaming-examples"></a><a href="#streaming-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Streaming Examples</h2>
<p>To run the stream examples for each of the collective communication model, please use the -stream
tag.</p>
<h4><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h4>
<p>Running a reduce streaming example using 4 workers, with a single iteration, source parallelism
as 8 and sink parallelism as one.</p>
<pre><code class="hljs css language-bash">./bin/twister2 submit standalone jar examples/libexamples-java.jar edu.iu.dsc.tws.examples.comms.ExampleMain -itr 1 -workers 4 -size 8 -op <span class="hljs-string">"reduce"</span> -stages 8,1 -verify -stream
</code></pre>
<p>You can use the same running commands used for batch examples, but use the -stream tag.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#twister2-collective-communications">Twister2 Collective Communications</a><ul class="toc-headings"><li><a href="#running-option-definitions">Running Option Definitions</a></li><li><a href="#communication-example-structure">Communication Example Structure</a></li></ul></li><li><a href="#batch-examples">Batch Examples</a><ul class="toc-headings"><li><a href="#reduce-example">Reduce Example</a></li><li><a href="#allreduce-example">AllReduce Example</a></li><li><a href="#gather-example">Gather Example</a></li><li><a href="#allgather-example">AllGather Example</a></li><li><a href="#partition-example">Partition Example</a></li><li><a href="#keyedreduce-example">KeyedReduce Example</a></li><li><a href="#keyedgather-example">KeyedGather Example</a></li><li><a href="#keyedpartition-example">KeyedPartition Example</a></li></ul></li><li><a href="#streaming-examples">Streaming Examples</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Indiana University</section></footer></div></body></html>